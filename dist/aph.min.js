!function(n,e){typeof exports==='object'&&typeof module!=='undefined'?module.exports=e():typeof define==='function'&&define.amd?define('$$',e):(n.$$=e())}(this,(function(){"use strict";let n=Array.prototype,e=document,t=(n,e)=>typeof n[e]!=='undefined',r=n=>typeof n==='string',u=n=>typeof n==='function';function o(n){let e=[];for(let t=0,r=n.length;t<r;t++)c(n[t])?(e=e.concat(o(n[t]))):(e.indexOf(n[t])<0&&e.push(n[t]));return e}function c(n){return n&&!r(n)&&!u(n)&&t(n,'length')}let l=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/;function f(n,t){let r;if(r=l.exec(n)){let n;if(n=r[3]){return t.getElementsByClassName(n)}if(n=r[2]){return t.getElementsByTagName(n)}if(n=r[1]){return e.getElementById(n)}}return t.querySelectorAll(n)}function i(n){return!n?e:n instanceof Node?n:r(n)?f(n,e)[0]:c(n)?n[0]:e}let a=/^<(\w+)\/?>(?:$|<\/\1>)/i,p;function h(n,t){if(!/\r|\n/.test(n)&&(t=a.exec(n))){return e.createElement(t[1])}if(!p){p=e.implementation.createHTMLDocument();let n=p.createElement('base');n.href=document.location.href;p.head.appendChild(n)}p.body.innerHTML=n;return p.body.childNodes[0]}function d(n){while(!n.aph)n=n.owner;return g(n)}function s(n,e,t){let r=n.map(n=>n[e](...t));return r&&r[0]!=null&&r[r.length-1]!=null?r:d(n)}function g(n){return new Proxy(n,{set(n,e,t){n.set(e,t)},get(n,e){if(e==='_target')return n;if(t(n,e)){if(u(n[e])){return n[e].bind(n)}return n[e]}if(n.length){if(u(n[0][e])){return y(e,n[0]).bind(n)}if(t(n[0],e)){return n.map(n=>n[e])}}return void 0}})}let m={};function y(n,e){let r=e.constructor.name;t(m,r)||(m[r]={});t(m[r],n)||(m[r][n]=n.substr(0,3)==='set'&&n[n.length-1]!=='s'?function(...e){if(e.length===1&&e[0].constructor===Object){return d(this.forEach(t=>{for(let r in e[0])t[n](r,e[0][r])}))}return s(this,n,e)}:function(...e){return s(this,n,e)});return m[r][n]}let E=['map','filter','forEach','get','set'];class w{constructor(n,e,t = {}){this.aph=t;this.aph.context=e=i(e);this.length=0;r(n)&&(n=n[0]==='<'&&n[n.length-1]==='>'?h(n):f(n,e));if(!n)return this;if(n.nodeType===1||n.nodeType===9||n===window)this[0]=n,this.length=1;else{for(let e=this.length=n.length;e--;this[e]=n[e]);}return this.aph.proxy=g(this)}forEach(n){for(let e=0,t=this.length;e<t&&n.call(this,this[e],e++)!==!1;);;return this}map(n){let e=[];for(let t=this.length;t--;e[t]=n(this[t],t,this));;return w.wrap(e,this)}filter(e){return w.wrap(n.filter.call(this,e),this)}find(n){return new w(n,this[0],{owner:this})}asArray(){return n.slice.call(this)}get(n){return this.map(e=>e[n])}set(n,e){return d(this.forEach(n.constructor===Object?e=>{for(let t in n)e[t]=n[t]}:t=>{t[n]=e}))}css(n,e){if(r(n)&&e==null){return this.map(e=>getComputedStyle(e)[n])}return this.aph.proxy.style.set(n,e)}detach(){return this.forEach(n=>n.parentNode.removeChild(n))}append(n){return this.html(n,(n,e)=>n.appendChild(e))}appendTo(n){return new w(n).append(this)&&this}prepend(n){return this.html(n,(n,e)=>n.insertBefore(e,n.firstChild))}prependTo(n){return new w(n).prepend(this)&&this}html(n,e){if(n==null){return this.map(n=>n.innerHTML)}if(!u(e)){return this.forEach(n=>{n.innerHTML=''}).append(n)}c(n)||(n=[n]);let t=o(n);return this.forEach(n=>t.forEach(t=>e(n,r(t)?h(t):t)))}static querySelector(n,e){return f(n,i(e))}static wrap(n,e){if(n[0]==null)return;c(n[0])&&n[0][0]&&n[0][0].nodeType===1&&(n=o(n));if(n[0]&&n[0].nodeType===1){return new w(n,e.aph?e.aph.context:null,{owner:e})}n.owner=e;E.forEach(e=>{n[e]=w.prototype[e]});return g(n)}}function T(n,e,t){return new w(n,e,t)}T.fn=w.prototype;T.wrap=w.wrap;T.querySelector=w.querySelector;return T}))