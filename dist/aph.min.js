!function(n,e){typeof exports==='object'&&typeof module!=='undefined'?module.exports=e():typeof define==='function'&&define.amd?define('$$',e):(n.$$=e())}(this,(function(){"use strict";let n=Array.prototype,e=document,t=(n,e)=>typeof n[e]!=='undefined',r=n=>typeof n==='string',o=n=>typeof n==='function';function u(n){let e=[];for(let t=0,r=n.length;t<r;t++)c(n[t])?(e=e.concat(u(n[t]))):(e.indexOf(n[t])<0&&e.push(n[t]));return e}function c(n){return n&&!r(n)&&!o(n)&&t(n,'length')}let l=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/;function i(n,t){let r;if(r=l.exec(n)){if(r[3]){return t.getElementsByClassName(r[3])}if(r[2]){return t.getElementsByTagName(r[2])}if(r[1]){return e.getElementById(r[1])}}return t.querySelectorAll(n)}function f(n){return!n?e:n instanceof Node?n:r(n)?i(n,e)[0]:c(n)?n[0]:e}let p=/^<(\w+)\/?>(?:$|<\/\1>)/,a=/\r|\n/,h;function d(n,t){if(!a.test(n)&&(t=p.exec(n))){return e.createElement(t[1])}if(!h){h=e.implementation.createHTMLDocument();let n=h.createElement('base');n.href=document.location.href;h.head.appendChild(n)}h.body.innerHTML=n;return h.body.childNodes[0]}function s(n){while(!n.aph)n=n.owner;return m(n)}function g(n,e,t){let r=n.map(n=>n[e](...t));return r&&r[0]!=null&&r[r.length-1]!=null?r:s(n)}function m(n){return new Proxy(n,{set(n,e,t){n.set(e,t)},get(n,e){if(t(n,e)){return o(n[e])?n[e].bind(n):n[e]}if(n.length){if(o(n[0][e])){return E(e,n[0]).bind(n)}if(t(n[0],e)){return n.map(n=>n[e])}}if(e==='_target'){return n}return void 0}})}let y={};function E(n,e){let r=e.constructor.name;t(y,r)||(y[r]={});t(y[r],n)||(y[r][n]=n.substr(0,3)==='set'&&n[n.length-1]!=='s'?function(...e){if(e.length===1&&e[0].constructor===Object){return s(this.forEach(t=>{for(let r in e[0])t[n](r,e[0][r])}))}return g(this,n,e)}:function(...e){return g(this,n,e)});return y[r][n]}class w{constructor(n,e,t = {}){this.aph=t;this.aph.context=e=f(e);this.length=0;r(n)&&(n=n[0]==='<'&&n[n.length-1]==='>'?d(n):i(n,e));if(!n)return this;if(n.nodeType===1||n.nodeType===9||n===window)this[0]=n,this.length=1;else{for(let e=this.length=n.length;e--;this[e]=n[e]);}return this.aph.proxy=m(this)}forEach(n){for(let e=0,t=this.length;e<t&&n.call(this,this[e],e++)!==!1;);;return this}map(n){let e=[];for(let t=this.length;t--;e[t]=n(this[t],t,this));;return w.wrap(e,this)}filter(e){return w.wrap(n.filter.call(this,e),this)}find(n){return new w(n,this[0],{owner:this})}asArray(){return n.slice.call(this)}get(n){return this.map(e=>e[n])}set(n,e){return s(this.forEach(n.constructor===Object?e=>{for(let t in n)e[t]=n[t]}:t=>{t[n]=e}))}css(n,e){if(r(n)&&e==null){return this.map(e=>getComputedStyle(e)[n])}return this.aph.proxy.style.set(n,e)}detach(){return this.forEach(n=>n.parentNode.removeChild(n))}append(n){return this.html(n,(n,e)=>n.appendChild(e))}appendTo(n){return new w(n).append(this)&&this}prepend(n){return this.html(n,(n,e)=>n.insertBefore(e,n.firstChild))}prependTo(n){return new w(n).prepend(this)&&this}html(n,e){if(n==null){return this.map(n=>n.innerHTML)}if(!o(e)){return this.forEach(n=>{n.innerHTML=''}).append(n)}c(n)||(n=[n]);let t=u(n);return this.forEach(n=>t.forEach(t=>e(n,r(t)?d(t):t)))}static querySelector(n,e){return i(n,f(e))}static wrap(n,e){if(n[0]==null)return;c(n[0])&&n[0][0]&&n[0][0].nodeType===1&&(n=u(n));if(n[0]&&n[0].nodeType===1){return new w(n,e.aph?e.aph.context:null,{owner:e})}n.owner=e;n.map=w.prototype.map;n.filter=w.prototype.filter;n.forEach=w.prototype.forEach;n.get=w.prototype.get;n.set=w.prototype.set;return m(n)}}function T(n,e,t){return new w(n,e,t)}T.fn=w.prototype;T.wrap=w.wrap;T.querySelector=w.querySelector;return T}))